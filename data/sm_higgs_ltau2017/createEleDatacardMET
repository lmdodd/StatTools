#!/bin/sh
preselection='pt_1>26&&pt_2>20&&vertices>0&&dilepton_veto==0&&iso_1<0.1&&tightElectrons<=1&&tightMuons==0&&againstElectronTightMVA6_2>0&&againstMuonLoose3_2>0&&byTightIsolationMVArun2v1DBoldDMwLT_2>0.5'
wselection='mtRecoil_1>80'
signalselection='mtRecoil_1<50'
zerojselection='njets==0&&pt_2>30'
zerojhighselection='njets==0&&pt_2>50'
onejselection='(njets==1||(njets==2&&vbfMass<300)||njets>2)&&pt_2>30'
onejboostselection='(njets==1||(njets==2&&vbfMass<500))&&(pt_2>40&&pt_sv>140)&&pt_2>30'
vbfselection='njets==2&&vbfMass>300'
vbfselectionHiggs=$vbfselection
vbfhighselection='njets==2&&vbfMass>800&&pt_sv>100'
vbfhighselectionHiggs=$vbfhighselection
trigselection='pt_1>26' #only for MC
trigselectiondata='(HLT_Ele25_eta2p1_WPTight_Gsf_v_fired>0&&lTrigger25>0)'
#relaxedSelection=$preselection
relaxedSelection='pt_1>26&&pt_2>20&&vertices>0&&dilepton_veto==0&&iso_1<0.3&&tightElectrons<=1&&tightMuons==0&&byMediumIsolationMVArun2v1DBoldDMwLT_2>0.5&&againstElectronLooseMVA6_2>0'
luminosity=12900. #pb
#direc='/hdfs/store/user/laura/SMHiggs_weighted/'
direc='/nfs_scratch/laura/SMHiggs_SVfit_weighted/'

datadirec=$direc
zttScale=1.
#zlftFactor=1.0
zlftFactor='EleTauFake'
tauID=0.90
topWeight='topWeight'
bTagSF=1.0
zWeight='__ZWEIGHT__'
qcdfactor=1.00

bins=30
#binning='binningHighStat=80.,200. binningLowStat=80.,200.'
binning='binningHighStat=0.,10.,20.,30.,40.,50.,60.,70.,80.,90.,100.,110.,120.,130.,140.,150.,160.,170.,180.,190.,200.,225.,250.,275.,300.,325.,350. binningLowStat=0.,25.,50.,70.,90.,110.,130.,150.,200.,250.,300.' 
mkdir datacards

###############wjets##############3
qcdfactor=0.74
nohup MakeDataCardHTT channel='eleTau' dataFile=$datadirec'eleDATA129.root' qcdFile=$direc'eleDATA129.root' zttFile=$direc'ZJETS.root' zllFile=$direc'ZJETS.root' wFile=$direc'WJETS.root' vvFile=$direc'DiBoson.root' topFile=$direc'TT.root' inclselection=$inclselection preselection=$preselection  wselection=$wselection relaxedSelection=$relaxedSelection trigselection=$trigselection trigselectiondata=$trigselectiondata  signalselection='pfmt_1EnUp<50'    qcdfactor=$qcdfactor zttScale=$zttScale zlftFactor=$zlftFactor  bTagSF=$bTagSF zerojselection=$zerojselection zerojhighselection=$zerojhighselection onejselection=$onejselection onejboostselection=$onejboostselection vbfselection=$vbfselection vbfselectionHiggs=$vbfselectionHiggs vbfhighselection=$vbfhighselection vbfhighselectionHiggs=$vbfhighselectionHiggs  muID=1.00  eleID=0.0 tauID=$tauID  dir=$direc'' bitmask=0,2,0,0 TTweight=$topWeight Zweight=$zWeight weight='__WEIGHT__*GENWEIGHT*puweight*idisoweight_1*trigweight_1*POGtrack'  luminosity=$luminosity    variable='m_vis' bins=1 min=80 max=200 outputFile='datacards/htt_et.inputs-sm-13TeV-m_vis-1.root' $binning >0jetUp& 
nohup MakeDataCardHTT channel='eleTau' dataFile=$datadirec'eleDATA129.root' qcdFile=$direc'eleDATA129.root' zttFile=$direc'ZJETS.root' zllFile=$direc'ZJETS.root' wFile=$direc'WJETS.root' vvFile=$direc'DiBoson.root' topFile=$direc'TT.root' inclselection=$inclselection preselection=$preselection  wselection=$wselection relaxedSelection=$relaxedSelection trigselection=$trigselection trigselectiondata=$trigselectiondata  signalselection='pfmt_1<50'    qcdfactor=$qcdfactor zttScale=$zttScale zlftFactor=$zlftFactor  bTagSF=$bTagSF zerojselection=$zerojselection zerojhighselection=$zerojhighselection onejselection=$onejselection onejboostselection=$onejboostselection vbfselection=$vbfselection vbfselectionHiggs=$vbfselectionHiggs vbfhighselection=$vbfhighselection vbfhighselectionHiggs=$vbfhighselectionHiggs  muID=1.00  eleID=0.0 tauID=$tauID  dir=$direc'' bitmask=0,2,0,0 TTweight=$topWeight Zweight=$zWeight weight='__WEIGHT__*GENWEIGHT*puweight*idisoweight_1*trigweight_1*POGtrack'  luminosity=$luminosity    variable='m_vis' bins=1 min=80 max=200 outputFile='datacards/htt_et.inputs-sm-13TeV-m_vis-1.root' $binning > 0jetNom& 
nohup MakeDataCardHTT channel='eleTau' dataFile=$datadirec'eleDATA129.root' qcdFile=$direc'eleDATA129.root' zttFile=$direc'ZJETS.root' zllFile=$direc'ZJETS.root' wFile=$direc'WJETS.root' vvFile=$direc'DiBoson.root' topFile=$direc'TT.root' inclselection=$inclselection preselection=$preselection  wselection=$wselection relaxedSelection=$relaxedSelection trigselection=$trigselection trigselectiondata=$trigselectiondata  signalselection='pfmt_1EnDown<50'  qcdfactor=$qcdfactor zttScale=$zttScale zlftFactor=$zlftFactor  bTagSF=$bTagSF zerojselection=$zerojselection zerojhighselection=$zerojhighselection onejselection=$onejselection onejboostselection=$onejboostselection vbfselection=$vbfselection vbfselectionHiggs=$vbfselectionHiggs vbfhighselection=$vbfhighselection vbfhighselectionHiggs=$vbfhighselectionHiggs  muID=1.00  eleID=0.0 tauID=$tauID  dir=$direc'' bitmask=0,2,0,0 TTweight=$topWeight Zweight=$zWeight weight='__WEIGHT__*GENWEIGHT*puweight*idisoweight_1*trigweight_1*POGtrack'  luminosity=$luminosity    variable='m_vis' bins=1 min=80 max=200 outputFile='datacards/htt_et.inputs-sm-13TeV-m_vis-1.root' $binning > 0jetDown& 
qcdfactor=1.0
nohup MakeDataCardHTT channel='eleTau' dataFile=$datadirec'eleDATA129.root' qcdFile=$direc'eleDATA129.root' zttFile=$direc'ZJETS.root' zllFile=$direc'ZJETS.root' wFile=$direc'WJETS.root' vvFile=$direc'DiBoson.root' topFile=$direc'TT.root' inclselection=$inclselection preselection=$preselection  wselection=$wselection relaxedSelection=$relaxedSelection trigselection=$trigselection trigselectiondata=$trigselectiondata  signalselection='pfmt_1EnUp<50'   qcdfactor=$qcdfactor zttScale=$zttScale zlftFactor=$zlftFactor  bTagSF=$bTagSF zerojselection=$zerojselection zerojhighselection=$zerojhighselection onejselection=$onejselection onejboostselection=$onejboostselection vbfselection=$vbfselection vbfselectionHiggs=$vbfselectionHiggs vbfhighselection=$vbfhighselection vbfhighselectionHiggs=$vbfhighselectionHiggs  muID=1.00  eleID=0.0 tauID=$tauID  dir=$direc'' bitmask=0,0,2,0 TTweight=$topWeight Zweight=$zWeight weight='__WEIGHT__*GENWEIGHT*puweight*idisoweight_1*trigweight_1*POGtrack'  luminosity=$luminosity    variable='m_sv' bins=1 min=80 max=200 outputFile='datacards/htt_et.inputs-sm-13TeV-m_sv-2.root' $binning >boostedEnUp & 
nohup MakeDataCardHTT channel='eleTau' dataFile=$datadirec'eleDATA129.root' qcdFile=$direc'eleDATA129.root' zttFile=$direc'ZJETS.root' zllFile=$direc'ZJETS.root' wFile=$direc'WJETS.root' vvFile=$direc'DiBoson.root' topFile=$direc'TT.root' inclselection=$inclselection preselection=$preselection  wselection=$wselection relaxedSelection=$relaxedSelection trigselection=$trigselection trigselectiondata=$trigselectiondata  signalselection='pfmt_1<50'  qcdfactor=$qcdfactor zttScale=$zttScale zlftFactor=$zlftFactor  bTagSF=$bTagSF zerojselection=$zerojselection zerojhighselection=$zerojhighselection onejselection=$onejselection onejboostselection=$onejboostselection vbfselection=$vbfselection vbfselectionHiggs=$vbfselectionHiggs vbfhighselection=$vbfhighselection vbfhighselectionHiggs=$vbfhighselectionHiggs  muID=1.00  eleID=0.0 tauID=$tauID  dir=$direc'' bitmask=0,0,2,0 TTweight=$topWeight Zweight=$zWeight weight='__WEIGHT__*GENWEIGHT*puweight*idisoweight_1*trigweight_1*POGtrack'  luminosity=$luminosity    variable='m_sv' bins=1 min=80 max=200 outputFile='datacards/htt_et.inputs-sm-13TeV-m_sv-2.root' $binning >boostedEnNom & 
nohup MakeDataCardHTT channel='eleTau' dataFile=$datadirec'eleDATA129.root' qcdFile=$direc'eleDATA129.root' zttFile=$direc'ZJETS.root' zllFile=$direc'ZJETS.root' wFile=$direc'WJETS.root' vvFile=$direc'DiBoson.root' topFile=$direc'TT.root' inclselection=$inclselection preselection=$preselection  wselection=$wselection relaxedSelection=$relaxedSelection trigselection=$trigselection trigselectiondata=$trigselectiondata  signalselection='pfmt_1EnDown<50'   qcdfactor=$qcdfactor zttScale=$zttScale zlftFactor=$zlftFactor  bTagSF=$bTagSF zerojselection=$zerojselection zerojhighselection=$zerojhighselection onejselection=$onejselection onejboostselection=$onejboostselection vbfselection=$vbfselection vbfselectionHiggs=$vbfselectionHiggs vbfhighselection=$vbfhighselection vbfhighselectionHiggs=$vbfhighselectionHiggs  muID=1.00  eleID=0.0 tauID=$tauID  dir=$direc'' bitmask=0,0,2,0 TTweight=$topWeight Zweight=$zWeight weight='__WEIGHT__*GENWEIGHT*puweight*idisoweight_1*trigweight_1*POGtrack'  luminosity=$luminosity    variable='m_sv' bins=1 min=80 max=200 outputFile='datacards/htt_et.inputs-sm-13TeV-m_sv-2.root' $binning >boostedEnDown & 
qcdfactor=1.15
nohup MakeDataCardHTT channel='eleTau' dataFile=$datadirec'eleDATA129.root' qcdFile=$direc'eleDATA129.root' zttFile=$direc'ZJETS.root' zllFile=$direc'ZJETS.root' wFile=$direc'WJETS.root' vvFile=$direc'DiBoson.root' topFile=$direc'TT.root' inclselection=$inclselection preselection=$preselection  wselection=$wselection relaxedSelection=$relaxedSelection trigselection=$trigselection trigselectiondata=$trigselectiondata  signalselection='pfmt_1EnUp<50'    qcdfactor=$qcdfactor zttScale=$zttScale zlftFactor=$zlftFactor  bTagSF=$bTagSF zerojselection=$zerojselection zerojhighselection=$zerojhighselection onejselection=$onejselection onejboostselection=$onejboostselection vbfselection=$vbfselection vbfselectionHiggs=$vbfselectionHiggs vbfhighselection=$vbfhighselection vbfhighselectionHiggs=$vbfhighselectionHiggs  muID=1.00  eleID=0.0 tauID=$tauID  dir=$direc'' bitmask=0,0,0,2 TTweight=$topWeight Zweight=$zWeight weight='__WEIGHT__*GENWEIGHT*puweight*idisoweight_1*trigweight_1*POGtrack'  luminosity=$luminosity    variable='m_sv' bins=1 min=80 max=200 outputFile='datacards/htt_et.inputs-sm-13TeV-m_sv-3.root'  $binning >vbfEnUp & 
nohup MakeDataCardHTT channel='eleTau' dataFile=$datadirec'eleDATA129.root' qcdFile=$direc'eleDATA129.root' zttFile=$direc'ZJETS.root' zllFile=$direc'ZJETS.root' wFile=$direc'WJETS.root' vvFile=$direc'DiBoson.root' topFile=$direc'TT.root' inclselection=$inclselection preselection=$preselection  wselection=$wselection relaxedSelection=$relaxedSelection trigselection=$trigselection trigselectiondata=$trigselectiondata  signalselection='pfmt_1<50'    qcdfactor=$qcdfactor zttScale=$zttScale zlftFactor=$zlftFactor  bTagSF=$bTagSF zerojselection=$zerojselection zerojhighselection=$zerojhighselection onejselection=$onejselection onejboostselection=$onejboostselection vbfselection=$vbfselection vbfselectionHiggs=$vbfselectionHiggs vbfhighselection=$vbfhighselection vbfhighselectionHiggs=$vbfhighselectionHiggs  muID=1.00  eleID=0.0 tauID=$tauID  dir=$direc'' bitmask=0,0,0,2 TTweight=$topWeight Zweight=$zWeight weight='__WEIGHT__*GENWEIGHT*puweight*idisoweight_1*trigweight_1*POGtrack'  luminosity=$luminosity    variable='m_sv' bins=1 min=80 max=200 outputFile='datacards/htt_et.inputs-sm-13TeV-m_sv-3.root'  $binning >vbfEnNom & 
nohup MakeDataCardHTT channel='eleTau' dataFile=$datadirec'eleDATA129.root' qcdFile=$direc'eleDATA129.root' zttFile=$direc'ZJETS.root' zllFile=$direc'ZJETS.root' wFile=$direc'WJETS.root' vvFile=$direc'DiBoson.root' topFile=$direc'TT.root' inclselection=$inclselection preselection=$preselection  wselection=$wselection relaxedSelection=$relaxedSelection trigselection=$trigselection trigselectiondata=$trigselectiondata  signalselection='pfmt_1EnDown<50'  qcdfactor=$qcdfactor zttScale=$zttScale zlftFactor=$zlftFactor  bTagSF=$bTagSF zerojselection=$zerojselection zerojhighselection=$zerojhighselection onejselection=$onejselection onejboostselection=$onejboostselection vbfselection=$vbfselection vbfselectionHiggs=$vbfselectionHiggs vbfhighselection=$vbfhighselection vbfhighselectionHiggs=$vbfhighselectionHiggs  muID=1.00  eleID=0.0 tauID=$tauID  dir=$direc'' bitmask=0,0,0,2 TTweight=$topWeight Zweight=$zWeight weight='__WEIGHT__*GENWEIGHT*puweight*idisoweight_1*trigweight_1*POGtrack'  luminosity=$luminosity    variable='m_sv' bins=1 min=80 max=200 outputFile='datacards/htt_et.inputs-sm-13TeV-m_sv-3.root'  $binning >vbfEnDown & 

exit;
